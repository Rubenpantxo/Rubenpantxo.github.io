# Create an updated HTML with daily history + calendar and APK guidance in code comments.
html_content = r"""<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Planificador semanal de men√∫s (con hist√≥rico y calendario)</title>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb;
    --muted:#94a3b8; --accent:#22c55e; --accent-2:#3b82f6; --danger:#ef4444; --warning:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
  h1,h2,h3{margin:0 0 .5rem}
  small{color:var(--muted)}
  .container{max-width:1250px;margin:0 auto;padding:16px;display:grid;grid-template-columns: 1fr 1.7fr 1.3fr;gap:16px}
  .card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .card .hd{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between}
  .card .bd{padding:14px 16px}
  .row{display:flex;gap:8px;align-items:center}
  .row.wrap{flex-wrap:wrap}
  .col{flex:1}
  input,select,button{border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:var(--text);padding:10px 12px;font-size:14px;outline:none}
  select{min-width:180px}
  button{cursor:pointer}
  button.primary{background:linear-gradient(180deg,var(--accent),#16a34a);border:none;color:#072b12;font-weight:600}
  button.secondary{background:linear-gradient(180deg,var(--accent-2),#1d4ed8);border:none;font-weight:600}
  button.ghost{background:transparent;border:1px dashed rgba(255,255,255,.2);color:var(--muted)}
  button.danger{background:linear-gradient(180deg,var(--danger),#b91c1c);border:none;color:#fff}
  .list{display:grid;grid-template-columns:1fr auto;gap:8px;margin-top:10px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:14px}
  .pill .icon{font-size:18px}
  .pill .del{margin-left:8px;background:transparent;border:none;color:var(--danger);cursor:pointer}
  .grid{display:grid;grid-template-columns: repeat(1, minmax(0,1fr));gap:12px}
  @media (min-width: 950px){
    .grid{grid-template-columns: repeat(7, minmax(0,1fr));}
  }
  .day{padding:10px;border-radius:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06)}
  .day h3{font-size:14px;color:var(--muted);margin-bottom:8px;display:flex;align-items:center;justify-content:space-between}
  .select-row{display:grid;grid-template-columns: 1fr auto;gap:8px;align-items:center;margin-bottom:8px}
  .select-row .emoji{font-size:20px;min-width:26px;text-align:center}
  .legend{display:flex;gap:8px;flex-wrap:wrap}
  .legend .tag{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:12px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .footer{max-width:1250px;margin:8px auto 24px;padding:0 16px;display:flex;justify-content:space-between;color:var(--muted);font-size:12px}
  a{color:#9bd0ff}

  /* Calendario */
  .cal-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .cal-nav{display:flex;gap:8px;align-items:center}
  .cal-grid{display:grid;grid-template-columns: repeat(7, 1fr);gap:6px}
  .cal-cell{aspect-ratio:1/1;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);padding:6px;display:flex;flex-direction:column;justify-content:space-between}
  .cal-cell header{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}
  .cal-cell .meal{font-size:16px;line-height:1.1}
  .cal-cell.today{outline:2px solid var(--accent-2)}
  .cal-cell.muted{opacity:.45}
  .details{margin-top:10px;font-size:14px;color:var(--muted)}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:6px;padding:1px 6px}
</style>
</head>
<body>
<div class="container">
  <!-- GESTOR DE PLATOS -->
  <section class="card">
    <div class="hd">
      <div>
        <h2>Gestor de platos</h2>
        <small>A√±ade o elimina platos de 1¬∫ y 2¬∫. Se guarda en tu navegador.</small>
      </div>
      <div class="toolbar">
        <button id="btnExportar" class="ghost" title="Exportar configuraci√≥n">Exportar</button>
        <input type="file" id="fileImportar" accept="application/json" style="display:none">
        <button id="btnImportar" class="ghost" title="Importar configuraci√≥n">Importar</button>
        <button id="btnRestablecer" class="danger" title="Volver a valores iniciales">Restablecer</button>
      </div>
    </div>
    <div class="bd">
      <div class="row">
        <input id="nuevoPrimero" class="col" placeholder="A√±adir 1¬∫ (p. ej. 'Macarrones')" />
        <button id="btnAddPrimero" class="primary">A√±adir 1¬∫</button>
      </div>
      <div id="listaPrimeros" class="list"></div>
      <hr style="border-color:rgba(255,255,255,.08);margin:14px 0">
      <div class="row">
        <input id="nuevoSegundo" class="col" placeholder="A√±adir 2¬∫ (p. ej. 'Lomo')" />
        <button id="btnAddSegundo" class="secondary">A√±adir 2¬∫</button>
      </div>
      <div id="listaSegundos" class="list"></div>
    </div>
  </section>

  <!-- PLANIFICADOR SEMANAL -->
  <section class="card">
    <div class="hd">
      <div>
        <h2>Planificador semanal</h2>
        <small>Selecciona 1¬∫ y 2¬∫ para cada d√≠a. Ver√°s un icono junto a cada selecci√≥n.</small>
      </div>
      <div class="toolbar">
        <button id="btnVaciarSemana" class="ghost">Vaciar semana</button>
        <button id="btnImprimir" class="ghost">Imprimir</button>
        <button id="btnGuardarHoy" class="primary">Guardar hoy</button>
      </div>
    </div>
    <div class="bd">
      <div class="legend">
        <span class="tag">ü•ó vegetal</span><span class="tag">üçù pasta</span><span class="tag">üçö arroz</span><span class="tag">üç≤ sopa/guiso</span>
        <span class="tag">ü´ò legumbre</span><span class="tag">ü•î patata</span><span class="tag">ü•© carne</span><span class="tag">üçó ave</span>
        <span class="tag">üêü pescado</span><span class="tag">ü¶ë marisco</span><span class="tag">üêå caracol</span>
      </div>
      <div id="grid" class="grid" style="margin-top:10px"></div>
      <small>Consejo: pulsa <span class="kbd">Guardar hoy</span> para registrar el men√∫ del d√≠a. Tambi√©n se guarda autom√°ticamente a medianoche si la p√°gina est√° abierta.</small>
    </div>
  </section>

  <!-- HIST√ìRICO & CALENDARIO -->
  <section class="card">
    <div class="hd">
      <div>
        <h2>Hist√≥rico y calendario</h2>
        <small>Consulta lo que comiste cada d√≠a. Navega meses.</small>
      </div>
      <div class="toolbar">
        <button id="btnHoy" class="ghost">Ir a hoy</button>
        <button id="btnBorrarHist" class="danger">Borrar hist√≥rico</button>
      </div>
    </div>
    <div class="bd">
      <div class="cal-hd">
        <div class="cal-nav">
          <button id="prevMonth" class="ghost">‚óÄ</button>
          <h3 id="calTitle"></h3>
          <button id="nextMonth" class="ghost">‚ñ∂</button>
        </div>
        <small>Lunes a Domingo</small>
      </div>
      <div class="cal-grid" id="calWeekdays"></div>
      <div class="cal-grid" id="calGrid" style="margin-top:6px"></div>
      <div class="details" id="calDetails"></div>
    </div>
  </section>
</div>

<div class="footer">
  <div>¬© Planificador de cocina</div>
  <div><a href="#" id="docAyuda">Ayuda</a></div>
</div>

<script>
/* ======= Datos por defecto ======= */
const DEFAULTS = {
  primeros: [
    "Macarrones","Espaguetis","Sopa","Croquetas","Esp√°rragos","Calderete","Arroz","Borraja",
    "Alubia verde","Menestra","Coliflor","Br√≥coli","Cardo",
    "Ensalada - Pasta","Ensalada - Garbanzos","Ensalada - Endivias","Ensalada - Nueces, manzana, queso","Ensaladilla rusa",
    "Gazpacho","Pisto","Pochas","Garbanzos","Lentejas","Arroz a la cubana","Patatas a la Riojana","Pur√©"
  ],
  segundos: [
    "Lomo","Pechugas","Muslitos de pollo","Pavo","Conejo","Cordero","Pollo","Solomillo","Filetes",
    "Cachopo","Ternera guisada","Carrilleras","Alb√≥ndigas","Caracoles",
    "Merluza","Bonito","Anchoas","Bacalao","Chicharro","Salmonetes","Calamares"
  ]
};

const DAYS = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];

/* ======= Utilidades ======= */
function save(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
function load(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback } catch { return fallback } }
function titleCase(s){ return s.replace(/\s+/g,' ').trim().replace(/\b\w/g, c => c.toUpperCase()); }
function fmtDateKey(d){ // YYYY-MM-DD en hora local
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function parseDateKey(k){
  const [y,m,d] = k.split("-").map(Number);
  return new Date(y, m-1, d);
}

/* Heur√≠stica de iconos */
function getIcon(name, tipo){
  if(!name) return "üçΩÔ∏è";
  const n = name.toLowerCase();
  const map = {
    "macarrones":"üçù","espaguetis":"üçù","sopa":"üç≤","croquetas":"üü†","esp√°rragos":"ü•¶","esparragos":"ü•¶",
    "calderete":"üç≤","arroz":"üçö","borraja":"ü•¶","alubia verde":"ü´ò","menestra":"ü•¶","coliflor":"ü•¶","br√≥coli":"ü•¶","brocoli":"ü•¶","cardo":"ü•¶",
    "ensalada - pasta":"ü•ó","ensalada - garbanzos":"ü•ó","ensalada - endivias":"ü•ó","ensalada - nueces, manzana, queso":"ü•ó","ensaladilla rusa":"ü•ó",
    "gazpacho":"ü•£","pisto":"ü•ò","pochas":"ü´ò","garbanzos":"ü´ò","lentejas":"ü´ò","arroz a la cubana":"üçö","patatas a la riojana":"ü•î","pur√©":"ü•£","pure":"ü•£",
    "lomo":"ü•©","pechugas":"üçó","muslitos de pollo":"üçó","pavo":"üçó","conejo":"ü•©","cordero":"ü•©","pollo":"üçó","solomillo":"ü•©","filetes":"ü•©",
    "cachopo":"ü•©","ternera guisada":"ü•©","carrilleras":"ü•©","alb√≥ndigas":"ü•©","caracoles":"üêå",
    "merluza":"üêü","bonito":"üêü","anchoas":"üêü","bacalao":"üêü","chicharro":"üêü","salmonetes":"üêü","calamares":"ü¶ë"
  };
  for(const k in map){ if(n === k) return map[k]; }
  if(/ensalada|endivia/.test(n)) return "ü•ó";
  if(/pasta|macarron|espaguet/.test(n)) return "üçù";
  if(/arroz/.test(n)) return "üçö";
  if(/sopa|caldo|crema|guis/.test(n)) return "üç≤";
  if(/garbanzo|lenteja|alubia|pocha/.test(n)) return "ü´ò";
  if(/patata/.test(n)) return "ü•î";
  if(tipo === 'segundo'){
    if(/pollo|pavo|muslito|pechuga/.test(n)) return "üçó";
    if(/lomo|solomillo|ternera|cordero|conejo|filete|cachopo|carrillera|alb√≥ndiga/.test(n)) return "ü•©";
    if(/merluza|bonito|anchoa|bacalao|chicharro|salmonete/.test(n)) return "üêü";
    if(/calamar|sepia|pulpo/.test(n)) return "ü¶ë";
    if(/caracol/.test(n)) return "üêå";
  } else {
    if(/br√≥coli|brocoli|coliflor|borraja|cardo|menestra|esp√°rrago|esparrago/.test(n)) return "ü•¶";
  }
  return "üçΩÔ∏è";
}

/* ======= Estado ======= */
const state = {
  primeros: load("primeros", null) || DEFAULTS.primeros.slice(),
  segundos: load("segundos", null) || DEFAULTS.segundos.slice(),
  semana: load("semana", DAYS.reduce((acc,d)=>{ acc[d] = {primero:"", segundo:""}; return acc; }, {})),
  historial: load("historial", {}), // { "YYYY-MM-DD": { primero, segundo } }
  lastSnapshot: load("lastSnapshot", null) // "YYYY-MM-DD"
};

function sync(){
  save("primeros", state.primeros);
  save("segundos", state.segundos);
  save("semana", state.semana);
  save("historial", state.historial);
  save("lastSnapshot", state.lastSnapshot);
  renderListas();
  renderSemana();
  renderCalendar();
}

/* ======= Render: Listas ======= */
function renderListas(){
  const elP = document.getElementById("listaPrimeros");
  const elS = document.getElementById("listaSegundos");
  elP.innerHTML = ""; elS.innerHTML = "";

  state.primeros.forEach((item, i)=>{
    const wrap = document.createElement("div"); wrap.className = "row";
    const pill = document.createElement("div"); pill.className = "pill col";
    const ico = document.createElement("span"); ico.className = "icon"; ico.textContent = getIcon(item,'primero');
    const txt = document.createElement("span"); txt.textContent = " " + item;
    const btn = document.createElement("button"); btn.className="del"; btn.innerHTML="‚úï"; btn.title="Eliminar";
    btn.onclick = ()=>{ state.primeros.splice(i,1); sync(); };
    pill.appendChild(ico); pill.appendChild(txt); wrap.appendChild(pill); wrap.appendChild(btn);
    elP.appendChild(wrap);
  });

  state.segundos.forEach((item, i)=>{
    const wrap = document.createElement("div"); wrap.className = "row";
    const pill = document.createElement("div"); pill.className = "pill col";
    const ico = document.createElement("span"); ico.className = "icon"; ico.textContent = getIcon(item,'segundo');
    const txt = document.createElement("span"); txt.textContent = " " + item;
    const btn = document.createElement("button"); btn.className="del"; btn.innerHTML="‚úï"; btn.title="Eliminar";
    btn.onclick = ()=>{ state.segundos.splice(i,1); sync(); };
    pill.appendChild(ico); pill.appendChild(txt); wrap.appendChild(pill); wrap.appendChild(btn);
    elS.appendChild(wrap);
  });
}

/* ======= Render: Semana ======= */
function renderSemana(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  DAYS.forEach(d => {
    const card = document.createElement("div");
    card.className = "day";
    const h = document.createElement("h3");
    h.innerHTML = d + ' <span style="font-weight:500;color:var(--text)">' + resumenDia(d) + '</span>';
    card.appendChild(h);

    const r1 = document.createElement("div"); r1.className = "select-row";
    const s1 = document.createElement("select");
    const e1 = document.createElement("div"); e1.className="emoji"; e1.textContent = getIcon(state.semana[d].primero,'primero');
    const optEmpty1 = document.createElement("option"); optEmpty1.value=""; optEmpty1.textContent="(Sin 1¬∫)";
    s1.appendChild(optEmpty1);
    state.primeros.forEach(p => { const o = document.createElement("option"); o.value=p; o.textContent=p; if(state.semana[d].primero===p) o.selected=true; s1.appendChild(o); });
    s1.onchange = (ev)=>{ state.semana[d].primero = ev.target.value; e1.textContent = getIcon(ev.target.value,'primero'); sync(); };
    r1.appendChild(s1); r1.appendChild(e1);
    card.appendChild(r1);

    const r2 = document.createElement("div"); r2.className = "select-row";
    const s2 = document.createElement("select");
    const e2 = document.createElement("div"); e2.className="emoji"; e2.textContent = getIcon(state.semana[d].segundo,'segundo');
    const optEmpty2 = document.createElement("option"); optEmpty2.value=""; optEmpty2.textContent="(Sin 2¬∫)";
    s2.appendChild(optEmpty2);
    state.segundos.forEach(p => { const o = document.createElement("option"); o.value=p; o.textContent=p; if(state.semana[d].segundo===p) o.selected=true; s2.appendChild(o); });
    s2.onchange = (ev)=>{ state.semana[d].segundo = ev.target.value; e2.textContent = getIcon(ev.target.value,'segundo'); sync(); };
    r2.appendChild(s2); r2.appendChild(e2);
    card.appendChild(r2);

    grid.appendChild(card);
  });
}

function resumenDia(d){
  const p = state.semana[d].primero;
  const s = state.semana[d].segundo;
  let parts = [];
  if(p) parts.push("1¬∫: " + p);
  if(s) parts.push("2¬∫: " + s);
  return parts.length ? parts.join(" ¬∑ ") : "";
}

/* ======= Hist√≥rico: snapshot diario ======= */
function snapshotHoy(manual=false){
  const now = new Date();
  const key = fmtDateKey(now);
  const diaSemana = DAYS[now.getDay() === 0 ? 6 : now.getDay()-1]; // Lunes=0
  const { primero, segundo } = state.semana[diaSemana] || { primero:"", segundo:"" };
  state.historial[key] = { primero, segundo };
  state.lastSnapshot = key;
  save("historial", state.historial);
  save("lastSnapshot", state.lastSnapshot);
  renderCalendar();
  if(manual) alert(`Guardado ${key}: 1¬∫ "${primero||"‚Äî"}", 2¬∫ "${segundo||"‚Äî"}"`);
}

function programarMedianoche(){
  const now = new Date();
  const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 0,0,2); // 00:00:02 pr√≥ximo d√≠a
  const ms = midnight - now;
  setTimeout(()=>{
    snapshotHoy(false); // guarda el d√≠a que termina
    programarMedianoche(); // reprograma
  }, ms);
}

// Al cargar, si han pasado d√≠as sin snapshot (app cerrada), rellenamos desde la √∫ltima selecci√≥n conocida
function reconciliarHistorial(){
  const todayKey = fmtDateKey(new Date());
  if(state.lastSnapshot === todayKey) return;
  let cursor = state.lastSnapshot ? parseDateKey(state.lastSnapshot) : null;
  let start = cursor ? new Date(cursor.getFullYear(), cursor.getMonth(), cursor.getDate()+1) : null;
  if(!start){ return; }
  const end = new Date();
  for(let d=new Date(start); d <= end; d.setDate(d.getDate()+1)){
    const key = fmtDateKey(d);
    const dow = d.getDay() === 0 ? 6 : d.getDay()-1;
    const diaSemana = DAYS[dow];
    const { primero, segundo } = state.semana[diaSemana] || { primero:"", segundo:"" };
    state.historial[key] = { primero, segundo };
  }
  state.lastSnapshot = todayKey;
}

/* ======= Calendario ======= */
const WD = ["L","M","X","J","V","S","D"];
let calYear = new Date().getFullYear();
let calMonth = new Date().getMonth(); // 0-11

function renderCalendar(){
  // cabecera d√≠as semana
  const wd = document.getElementById("calWeekdays");
  if(!wd.dataset.ready){
    WD.forEach(l => {
      const c = document.createElement("div");
      c.className = "cal-cell muted"; c.style.aspectRatio = "unset"; c.style.padding="8px";
      c.innerHTML = `<header><strong>${l}</strong></header>`;
      wd.appendChild(c);
    });
    wd.dataset.ready = "1";
  }

  const grid = document.getElementById("calGrid");
  grid.innerHTML = "";
  const title = document.getElementById("calTitle");
  const first = new Date(calYear, calMonth, 1);
  const firstWD = (first.getDay()+6)%7; // lunes=0
  const daysInMonth = new Date(calYear, calMonth+1, 0).getDate();
  title.textContent = first.toLocaleDateString(undefined, { month:"long", year:"numeric" });

  // d√≠as del calendario (incluye celdas previas para alinear con lunes)
  const totalCells = firstWD + daysInMonth;
  const todayKey = fmtDateKey(new Date());

  for(let i=0;i<totalCells;i++){
    const cell = document.createElement("div");
    cell.className = "cal-cell";
    const dayNum = i - firstWD + 1;
    let dateObj, muted=false;
    if(i < firstWD){
      // d√≠as del mes anterior (opcional: dejar vac√≠os)
      muted = true;
      cell.classList.add("muted");
      cell.innerHTML = `<header><span></span><span></span></header>`;
      grid.appendChild(cell);
      continue;
    } else {
      dateObj = new Date(calYear, calMonth, dayNum);
    }
    const key = fmtDateKey(dateObj);
    const rec = state.historial[key] || null;
    const isToday = key === todayKey;
    if(isToday) cell.classList.add("today");

    const pIcon = rec ? getIcon(rec.primero, 'primero') : "";
    const sIcon = rec ? getIcon(rec.segundo, 'segundo') : "";

    cell.innerHTML = `
      <header><span>${dayNum}</span><span style="opacity:.7">${rec ? "‚úì" : ""}</span></header>
      <div class="meal">${rec ? pIcon+" "+sIcon : "<span style='opacity:.4'>‚Äî</span>"}</div>
    `;
    cell.title = rec ? `1¬∫: ${rec.primero || "‚Äî"} | 2¬∫: ${rec.segundo || "‚Äî"}` : "Sin registro";
    cell.onclick = ()=>{
      const det = document.getElementById("calDetails");
      det.innerHTML = `<strong>${key}</strong> ‚Äî ${rec ? `1¬∫: ${rec.primero || "‚Äî"} ¬∑ 2¬∫: ${rec.segundo || "‚Äî"}` : "Sin registro"}`;
    };
    grid.appendChild(cell);
  }
}

/* ======= Eventos ======= */
document.getElementById("btnAddPrimero").onclick = ()=>{
  const el = document.getElementById("nuevoPrimero");
  const v = titleCase(el.value);
  if(!v) return;
  if(!state.primeros.includes(v)){ state.primeros.push(v); el.value=""; sync(); }
};

document.getElementById("btnAddSegundo").onclick = ()=>{
  const el = document.getElementById("nuevoSegundo");
  const v = titleCase(el.value);
  if(!v) return;
  if(!state.segundos.includes(v)){ state.segundos.push(v); el.value=""; sync(); }
};

document.getElementById("btnVaciarSemana").onclick = ()=>{
  if(confirm("¬øVaciar todas las selecciones de la semana?")){
    DAYS.forEach(d => state.semana[d] = {primero:"", segundo:""});
    sync();
  }
};

document.getElementById("btnImprimir").onclick = ()=>{ window.print(); };
document.getElementById("btnRestablecer").onclick = ()=>{
  if(confirm("¬øRestablecer listas y semana a los valores iniciales?")){
    state.primeros = DEFAULTS.primeros.slice();
    state.segundos = DEFAULTS.segundos.slice();
    DAYS.forEach(d => state.semana[d] = {primero:"", segundo:""});
    state.historial = {};
    state.lastSnapshot = null;
    sync();
  }
};
document.getElementById("btnGuardarHoy").onclick = ()=> snapshotHoy(true);

// Exportar/Importar (ahora incluye hist√≥rico)
document.getElementById("btnExportar").onclick = ()=>{
  const data = {
    primeros: state.primeros,
    segundos: state.segundos,
    semana: state.semana,
    historial: state.historial,
    lastSnapshot: state.lastSnapshot
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "config_menu.json";
  document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); a.remove();
};

document.getElementById("btnImportar").onclick = ()=> document.getElementById("fileImportar").click();
document.getElementById("fileImportar").addEventListener("change", (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = (ev)=>{
    try{
      const data = JSON.parse(ev.target.result);
      if(Array.isArray(data.primeros) && Array.isArray(data.segundos) && typeof data.semana === "object"){
        state.primeros = data.primeros.map(titleCase);
        state.segundos = data.segundos.map(titleCase);
        state.semana = data.semana;
        state.historial = data.historial || {};
        state.lastSnapshot = data.lastSnapshot || null;
        sync();
      } else { alert("Archivo no v√°lido."); }
    }catch(err){ alert("No se pudo leer el archivo."); }
  };
  reader.readAsText(file);
});

// Calendario navegaci√≥n
document.getElementById("prevMonth").onclick = ()=>{ calMonth--; if(calMonth<0){ calMonth=11; calYear--; } renderCalendar(); };
document.getElementById("nextMonth").onclick = ()=>{ calMonth++; if(calMonth>11){ calMonth=0; calYear++; } renderCalendar(); };
document.getElementById("btnHoy").onclick = ()=>{ const now=new Date(); calYear=now.getFullYear(); calMonth=now.getMonth(); renderCalendar(); };
document.getElementById("btnBorrarHist").onclick = ()=>{
  if(confirm("¬øBorrar todo el hist√≥rico?")){
    state.historial = {}; state.lastSnapshot = null; sync();
  }
};

// Ayuda
document.getElementById("docAyuda").onclick = (e)=>{
  e.preventDefault();
  alert("‚Ä¢ A√±ade platos en el gestor de la izquierda.\n‚Ä¢ Planifica la semana seleccionando 1¬∫ y 2¬∫.\n‚Ä¢ Pulsa 'Guardar hoy' para registrar el men√∫ diario.\n‚Ä¢ Si dejas la p√°gina abierta, guardar√° autom√°ticamente al llegar medianoche.\n‚Ä¢ Exporta/Importa para hacer copia de seguridad.");
};

/* ======= Inicio ======= */
// Ajuste inicial de lastSnapshot (si nunca se guard√≥)
if(!state.lastSnapshot){ state.lastSnapshot = fmtDateKey(new Date()); }
reconciliarHistorial();
renderListas();
renderSemana();
renderCalendar();
programarMedianoche();

/* ============
NOTA PARA APK (resumen):
- Puedes empaquetar este HTML como app Android con:
  A) Capacitor (recomendado): npm init; npm i @capacitor/core @capacitor/cli; npx cap init; colocar este HTML como /dist/index.html; npx cap add android; npx cap copy; abrir Android Studio; build APK/AAB.
  B) Cordova: cordova create; cordova platform add android; cordova build android; coloca este HTML en www/ y establece <content src="index.html" />.
  C) WebView nativo: crear proyecto Android, usar WebView para cargar archivo local (assets) y habilitar localStorage.
  D) PWA + TWA (Play Store): convertir en PWA (manifest + service worker) y empaquetar con bubblewrap.
============ */
</script>
</body>
</html>
"""
path = "/mnt/data/planificador_menus_historial.html"
with open(path, "w", encoding="utf-8") as f:
    f.write(html_content)
path