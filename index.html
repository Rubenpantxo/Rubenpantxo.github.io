<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototipo - Rubenpantxo.com</title>
    <!-- Importamos una fuente para darle un toque más personal -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Importamos iconos de Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo general con la textura de cuaderno y la fuente principal */
        body {
            font-family: 'Inter', sans-serif;
            /* Textura de cuaderno sutil. Se puede cambiar por cualquier otra imagen. */
            background-color: #fdfdf8;
            background-image:
                linear-gradient(90deg, transparent 79px, #abced4 79px, #abced4 81px, transparent 81px),
                linear-gradient(#eee .1em, transparent .1em);
            background-size: 100% 1.2em;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
        }

        /* Estilo para el título principal, con una fuente que parece escrita a mano */
        .titulo-principal {
            font-family: 'Kalam', cursive;
            color: #003366; /* Un azul oscuro */
        }

        /* Contenedor de los botones de navegación */
        #main-nav {
            transition: transform 0.5s ease-in-out;
        }

        /* Estilo de cada botón de navegación */
        .nav-item {
            font-family: 'Kalam', cursive;
            font-weight: 700;
            background-color: #ffffff;
            border: 2px solid #333;
            box-shadow: 5px 5px 0px #333;
            position: relative;
            cursor: pointer;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s ease, box-shadow 0.2s ease, font-size 0.3s ease;
        }

        .nav-item:hover {
            box-shadow: 2px 2px 0px #333;
            transform: translate(3px, 3px);
        }

        /* La "cuerda" que cuelga de cada botón */
        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 40px; /* Longitud de la cuerda */
            background: linear-gradient(to bottom, #8B4513, #D2691E); /* Marrón de cuerda */
            z-index: -1;
        }

        /* --- LÓGICA DE ANIMACIÓN --- */
        /* Cuando se abre una sección, se añade la clase 'section-open' al body */
        body.section-open .nav-item {
            /* Por defecto, todos los botones suben */
            transform: translateY(-300px);
            opacity: 0;
            pointer-events: none; /* Evita que se pueda hacer clic cuando están ocultos */
        }

        /* El botón activo (el que se ha clicado) se queda en su sitio y actúa como título */
        body.section-open .nav-item.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
            box-shadow: 2px 2px 0px #1a73e8;
            border-color: #1a73e8;
            font-size: 1.5rem; /* Hacemos el texto más grande para que parezca un título */
        }

        /* Estilo de los iconos de la esquina (interrogante y volver) */
        .corner-icon {
            font-size: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease;
            position: absolute;
            top: 20px;
            right: 20px;
            border: 2px solid #333;
        }
        
        /* NUEVO ESTILO: Botón de interrogante inspirado en la imagen */
        #contact-toggle {
            background-color: #ffde59; /* Amarillo */
            color: #333;
            font-weight: bold;
            box-shadow: 3px 3px 0 #333, inset 2px 2px 0px rgba(255,255,255,0.5);
        }
        
        #back-arrow {
            background-color: #dc3545; /* Rojo */
            color: white;
            box-shadow: 3px 3px 0 #333;
        }

        /* Animación para la aparición y desaparición de los iconos */
        .icon-hidden {
            transform: scale(0);
            opacity: 0;
            pointer-events: none;
        }

        /* Contenedor de los logos de redes sociales */
        #social-links {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .social-hidden {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }
        
        /* Contenedor del contenido de cada sección */
        .content-section {
            transition: opacity 0.5s ease 0.2s, transform 0.5s ease 0.2s;
        }

        .content-hidden {
            opacity: 0;
            transform: translateY(30px);
            display: none;
        }

        /* --- NUEVO ESTILO: Sección de Apps (Boya de pesca) --- */
        .fishing-bobber-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .fishing-line {
            width: 2px;
            height: 80px;
            background: #555;
        }
        .fishing-bobber {
            width: 80px;
            height: 80px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(5px 5px 3px rgba(0,0,0,0.2));
        }
        .bobber-top {
            position: absolute;
            top: 0;
            width: 100%;
            height: 50%;
            background-color: #ef4444; /* Rojo */
            border-top-left-radius: 40px;
            border-top-right-radius: 40px;
            border: 2px solid #1f2937;
        }
        .bobber-bottom {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50%;
            background-color: #fde047; /* Amarillo */
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            border: 2px solid #1f2937;
        }
        .bobber-text {
            position: relative;
            z-index: 10;
            color: #1f2937;
            font-family: 'Kalam', cursive;
            font-weight: 700;
            font-size: 1.5rem;
            text-shadow: 1px 1px 0px white;
        }
        /* Fin de la sección de Apps */

        .sea-background {
            width: 100%;
            height: 150px;
            background: linear-gradient(to top, #0077be, #89cff0);
            position: relative;
            overflow: hidden;
            border-top: 5px solid #005a8d;
        }
        .wave {
            position: absolute;
            bottom: 0;
            width: 200%;
            height: 100px;
            background-image: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/85486/wave.svg');
            background-size: 50% 100px;
            animation: wave 5s cubic-bezier(0.36, 0.45, 0.63, 0.53) infinite;
        }
        .wave.two {
            animation-duration: 7s;
            opacity: 0.5;
        }
        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        /* ----- Estilos para la aplicación de diseño solar ----- */
        .result-card { background: linear-gradient(145deg, #1e3a8a, #3b82f6); }
        .card { background-color: rgba(55, 65, 81, 0.5); border: 1px solid #4b5567; }
        .tool-btn.active { background-color: #3b82f6; color: white; transform: scale(1.05); box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .asset { cursor: grab; transition: transform 0.2s ease; }
        .asset:hover { transform: scale(1.05); }
        .asset:active { cursor: grabbing; }
        .texture-thumb { cursor: pointer; border: 2px solid transparent; transition: border-color 0.2s ease; background-size: cover; background-position: center; }
        .texture-thumb:hover, .texture-thumb.active { border-color: #3b82f6; }
        #canvas-container { position: relative; }
        #roofCanvas { background-size: 250px; background-repeat: repeat; image-rendering: auto; }

        .app-card {
            border: 2px solid #333;
            border-radius: 0.75rem;
            padding: 1rem;
            background-color: #ffffff;
            box-shadow: 5px 5px 0px rgba(51, 51, 51, 0.35);
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
            text-align: left;
        }
        .app-card:hover {
            transform: translateY(-4px);
            box-shadow: 8px 8px 0px rgba(26, 115, 232, 0.35);
        }
        .app-card.active {
            border-color: #1a73e8;
            box-shadow: 6px 6px 0px rgba(26, 115, 232, 0.5);
        }
        .app-card__icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #eff6ff;
            color: #1d4ed8;
            transition: background-color 0.25s ease, color 0.25s ease;
        }
        .app-card.active .app-card__icon {
            background-color: #1a73e8;
            color: #ffffff;
        }
        .keyword-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            border: 1px solid rgba(59, 130, 246, 0.6);
            background-color: rgba(59, 130, 246, 0.15);
            color: #1d4ed8;
            font-size: 0.75rem;
            text-transform: lowercase;
            letter-spacing: 0.02em;
        }
        .link-group {
            border: 2px dashed rgba(148, 163, 184, 0.6);
            border-radius: 1rem;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
        }
        .link-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .link-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(15, 118, 110, 0.2);
        }
        .news-card {
            border-left: 6px solid #1d4ed8;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8 transition-all duration-500">

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="max-w-5xl mx-auto">

        <!-- CABECERA -->
        <header class="relative text-center py-6">
            <div class="flex justify-center items-center gap-4">
                <h1 class="titulo-principal text-5xl md:text-7xl font-bold">Rubenpantxo.com</h1>
                <!-- Logo principal desde los assets del repositorio -->
                <img src="img/logo.PNG" alt="Logo Rubenpantxo" class="h-16" decoding="async">
            </div>
            
            <!-- Iconos de la esquina -->
            <div id="contact-toggle" class="corner-icon flex items-center justify-center">?</div>
            <div id="back-arrow" class="corner-icon flex items-center justify-center icon-hidden">↩</div>

            <!-- Logos de redes sociales (ocultos al inicio) -->
            <div id="social-links" class="absolute top-20 right-8 mt-2 flex flex-col items-center gap-4 social-hidden">
                <a href="#" class="text-3xl text-pink-600 hover:scale-110 transition-transform"><i class="fab fa-instagram"></i></a>
                <a href="#" class="text-3xl text-red-600 hover:scale-110 transition-transform"><i class="fas fa-envelope"></i></a>
                <a href="#" class="text-3xl text-gray-800 hover:scale-110 transition-transform"><i class="fab fa-github"></i></a>
            </div>
        </header>

        <!-- NAVEGACIÓN PRINCIPAL (LOS 3 BOTONES COLGANTES) -->
        <nav id="main-nav" class="flex flex-col sm:flex-row justify-center items-center gap-8 sm:gap-12 mt-8">
            <div class="nav-item text-xl p-4 rounded-lg" data-section="noticias">Noticias y Artículos</div>
            <div class="nav-item text-xl p-4 rounded-lg" data-section="apps">Apps y Entretenimiento</div>
            <div class="nav-item text-xl p-4 rounded-lg" data-section="enlaces">Enlaces Web</div>
        </nav>

        <!-- CONTENIDO DE LAS SECCIONES (OCULTAS AL INICIO) -->
        <main id="content-container" class="mt-16">
            
            <!-- Sección 1: Noticias -->
            <section id="noticias-content" class="content-section content-hidden">
                <!-- El título H2 ha sido eliminado. El botón activo ahora sirve de título. -->
                <div class="grid md:grid-cols-2 gap-8 items-start pt-8">
                    
                    <!-- Columna Izquierda: Noticias -->
                    <div class="space-y-6">
                        <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
                            <div>
                                <h3 class="text-2xl font-bold border-b-2 pb-2 border-gray-400">Últimas de Tecnología</h3>
                                <p class="text-sm text-gray-600">Gestiona las noticias editando el archivo <code class="bg-gray-100 px-1 py-0.5 rounded">js/site-data.js</code>.</p>
                            </div>
                            <div class="flex flex-col gap-2 text-sm text-gray-700 md:flex-row md:items-center">
                                <label for="news-filter" class="font-semibold">Filtrar por temática</label>
                                <select id="news-filter" class="rounded-lg border-2 border-gray-400 px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                                    <option value="all">Todas</option>
                                </select>
                            </div>
                        </div>
                        <div id="news-last-update" class="text-xs uppercase tracking-wide text-gray-500"></div>
                        <div id="news-list" class="space-y-4"></div>
                    </div>
                    <!-- Columna Derecha: Dibujo -->

                    <div class="p-4 border-dashed border-4 rounded-lg bg-white/50 h-full min-h-[300px] flex items-center justify-center sticky top-24">
                        <p class="text-gray-500 text-lg">Aquí irá el dibujo decorativo</p>
                    </div>
                </div>
            </section>

            <!-- Sección 2: Apps y Entretenimiento -->
            <section id="apps-content" class="content-section content-hidden">
                <div class="space-y-10 pt-8">
                    <div class="rounded-2xl border-4 border-dashed border-blue-300/70 bg-white/90 p-6 shadow-lg">
                        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                            <div class="text-left">
                                <h3 class="text-2xl font-bold text-blue-800">Centro de aplicaciones</h3>
                                <p class="text-sm text-gray-600 max-w-2xl">Selecciona una tarjeta para abrir la herramienta correspondiente. Puedes añadir nuevas aplicaciones desde <code class="bg-blue-100 px-1 py-0.5 rounded">js/site-data.js</code>.</p>
                            </div>
                            <button id="apps-reset" class="self-start rounded-lg border-2 border-blue-500 px-4 py-2 text-sm font-semibold text-blue-700 transition hover:bg-blue-500 hover:text-white">Limpiar selección</button>
                        </div>
                        <div id="apps-grid" class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
                    </div>

                    <div class="rounded-2xl border-2 border-blue-200 bg-slate-900/80 p-4 sm:p-6 shadow-2xl">
                        <div id="app-placeholder" class="flex min-h-[220px] items-center justify-center text-center text-slate-200">
                            <div>
                                <p class="text-lg font-semibold">Selecciona una aplicación del panel superior.</p>
                                <p class="mt-2 text-sm text-slate-300">El contenido se cargará aquí sin salir de la página principal.</p>
                            </div>
                        </div>
                        <div id="app-panels" class="space-y-6">
                            <div class="app-panel hidden" data-app-panel="solar-designer">
                                <!-- Aplicación de Cálculo de Paneles Solares -->
                                <div class="w-full max-w-full mx-auto flex flex-col lg:flex-row gap-4 h-[95vh]">
                                    <!-- Panel de Controles Izquierdo -->
                                    <div class="w-full lg:w-1/4 xl:w-1/5 flex flex-col gap-4">
                                        <header class="text-center">
                                            <h1 class="text-2xl font-bold text-blue-400">Diseño Solar Visual</h1>
                                        </header>
                                        <div class="card p-4 rounded-xl">
                                            <h2 class="text-xl font-bold mb-3">Componentes</h2>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div id="asset-panel" draggable="true" class="asset bg-gray-800 p-2 rounded-lg flex flex-col items-center justify-center text-center aspect-w-3 aspect-h-4">
                                                    <img src="img/Panel1800x1134.png" alt="Panel Solar" class="max-h-24 object-contain pointer-events-none">
                                                    <span class="text-xs mt-1">Panel</span>
                                                </div>
                                                <div id="asset-profile" draggable="true" class="asset bg-gray-800 p-2 rounded-lg flex flex-col items-center justify-center text-center">
                                                    <img src="img/Perfil3500x60.png" alt="Perfil de Montaje" class="h-24 object-contain pointer-events-none transform -rotate-45">
                                                    <span class="text-xs mt-1">Perfil</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Configuración de Componentes -->
                                        <div class="card p-4 rounded-xl">
                                            <h2 class="text-xl font-bold mb-3">Configuración</h2>
                                            <div class="space-y-3">
                                                <div>
                                                    <h4 class="font-semibold text-sm mb-1 text-gray-300">Panel Solar</h4>
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <label class="text-xs">Ancho (mm)<input id="panel-width" type="number" value="1134" class="config-input mt-1 w-full bg-gray-800 rounded p-1 text-sm"></label>
                                                        <label class="text-xs">Alto (mm)<input id="panel-height" type="number" value="1800" class="config-input mt-1 w-full bg-gray-800 rounded p-1 text-sm"></label>
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold text-sm mb-1 text-gray-300">Perfil</h4>
                                                    <div class="grid grid-cols-1 gap-2">
                                                        <label class="text-xs">Longitud (mm)<input id="profile-length" type="number" value="3500" class="config-input mt-1 w-full bg-gray-800 rounded p-1 text-sm"></label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="result-card text-white p-4 rounded-xl shadow-lg text-center flex-grow flex flex-col justify-center">
                                            <h3 class="text-md font-medium opacity-80">Paneles / Piezas</h3>
                                            <div class="flex justify-around items-center mt-2">
                                                <div class="text-center">
                                                    <p id="totalPanels" class="text-4xl font-bold">0</p>
                                                    <span class="text-xs opacity-80">Paneles</span>
                                                </div>
                                                <div class="text-center">
                                                    <p id="totalClamps" class="text-4xl font-bold">0</p>
                                                    <span class="text-xs opacity-80">Piezas</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Panel Central (Canvas) -->
                                    <div class="w-full lg:w-1/2 xl:w-3/5 h-full rounded-lg shadow-2xl border border-blue-500/30 p-2 flex flex-col gap-2">
                                        <div id="canvas-toolbar" class="flex items-center justify-between p-2 bg-gray-800/50 rounded-lg">
                                            <div class="flex gap-2">
                                                <button data-mode="move" class="tool-btn active bg-gray-700 p-2 rounded-lg" title="Mover y Seleccionar">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M5 9l-3 3 3 3"></path>
                                                        <path d="M9 5l3-3 3 3"></path>
                                                        <path d="M15 19l-3 3-3-3"></path>
                                                        <path d="M19 9l3 3-3 3"></path>
                                                        <path d="M2 12h20"></path>
                                                        <path d="M12 2v20"></path>
                                                    </svg>
                                                </button>
                                                <button data-mode="delete" class="tool-btn bg-gray-700 p-2 rounded-lg" title="Borrar Elemento">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="text-sm text-gray-400">Rueda del ratón: Zoom. Clic derecho: Mover vista.</div>
                                        </div>
                                        <div id="canvas-container" class="w-full h-full bg-gray-800 rounded-lg">
                                            <canvas id="roofCanvas" class="w-full h-full"></canvas>
                                        </div>
                                    </div>
                                    <!-- Panel Derecho -->
                                    <div class="w-full lg:w-1/4 xl:w-1/5 flex flex-col gap-4">
                                        <div class="card p-4 rounded-xl">
                                            <h2 class="text-xl font-bold mb-3">Textura del Tejado</h2>
                                            <div id="texture-selector" class="grid grid-cols-2 gap-2">
                                                <div data-texture="img/tejas.jpg" class="texture-thumb active aspect-square rounded" style="background-image: url('img/tejas.jpg')" alt="Teja Tradicional"></div>
                                                <div data-texture="img/tejas_2.jpg" class="texture-thumb aspect-square rounded" style="background-image: url('img/tejas_2.jpg')" alt="Teja Plana"></div>
                                                <div data-texture="img/tejas_3.jpg" class="texture-thumb aspect-square rounded" style="background-image: url('img/tejas_3.jpg')" alt="Pizarra Oscura"></div>
                                                <div data-texture="img/tejas_3.jpg" class="texture-thumb aspect-square rounded" style="background-image: url('img/tejas_3.jpg')" alt="Teja Mixta"></div>
                                            </div>
                                        </div>
                                        <div id="controls-container" class="card p-4 rounded-xl flex-grow overflow-y-auto">
                                            <h2 class="text-xl font-bold mb-3">Zonas del Tejado</h2>
                                            <div id="zonesContainer" class="space-y-4"></div>
                                            <button id="addZoneBtn" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">+ Añadir Zona</button>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                    (function() {
                                        const appSection = document.getElementById('apps-content');
                                        if (!appSection) return;
                                        const panel = appSection.querySelector('[data-app-panel="solar-designer"]');
                                        if (!panel) return;

                                        const canvas = panel.querySelector('#roofCanvas');
                                        const ctx = canvas.getContext('2d');
                                        const zonesContainer = panel.querySelector('#zonesContainer');
                                        const addZoneBtn = panel.querySelector('#addZoneBtn');
                                        const totalPanelsEl = panel.querySelector('#totalPanels');
                                        const totalClampsEl = panel.querySelector('#totalClamps');
                                        const toolbar = panel.querySelector('#canvas-toolbar');
                                        const assetPanel = panel.querySelector('#asset-panel');
                                        const assetProfile = panel.querySelector('#asset-profile');
                                        const textureSelector = panel.querySelector('#texture-selector');
                                        const panelWidthInput = panel.querySelector('#panel-width');
                                        const panelHeightInput = panel.querySelector('#panel-height');
                                        const profileLengthInput = panel.querySelector('#profile-length');

                                        const PROFILE_VISUAL_WIDTH = 40;
                                        const CLAMP_MID_WIDTH = 40;
                                        const CLAMP_END_WIDTH = 25;
                                        const CLAMP_HEIGHT = 50;

                                        let state = {
                                            zones: [], profiles: [], panels: [], clamps: [],
                                            mode: 'move', selectedObject: null, isDragging: false, isPanning: false,
                                            dragOffset: { x: 0, y: 0 }, panStart: { x: 0, y: 0 },
                                            scale: 0.05, panOffset: { x: 50, y: 50 }
                                        };
                                        let zoneCounter = 0; let elementCounter = 0;

                                        function updateCanvasSize() {
                                            const parent = canvas.parentElement;
                                            canvas.width = parent.clientWidth;
                                            canvas.height = parent.clientHeight;
                                        }

                                        function addZone(width = 5970, height = 3420) {
                                            zoneCounter++;
                                            const zone = { id: 'zone-' + zoneCounter, width: width, height: height };
                                            state.zones.push(zone);
                                            renderZoneControls();
                                            draw();
                                        }
                                        function removeZone(id) {
                                            state.zones = state.zones.filter(function(z) { return z.id !== id; });
                                            renderZoneControls();
                                            draw();
                                        }
                                        function updateZone(id, field, value) {
                                            const zone = state.zones.find(function(z) { return z.id === id; });
                                            if (zone) {
                                                zone[field] = parseInt(value) || 0;
                                                draw();
                                            }
                                        }
                                        function renderZoneControls() {
                                            zonesContainer.innerHTML = state.zones.map(function(zone) {
                                                return '<div class="bg-gray-700/50 p-3 rounded-lg">' +
                                                    '<div class="flex justify-between items-center mb-2">' +
                                                    '<h3 class="font-bold text-md text-blue-300">Zona ' + zone.id.split('-')[1] + '</h3>' +
                                                    '<button class="remove-zone-btn text-red-400 hover:text-red-300" data-id="' + zone.id + '">✕</button>' +
                                                    '</div>' +
                                                    '<div class="grid grid-cols-2 gap-2">' +
                                                    '<label class="text-xs">Ancho<input type="number" value="' + zone.width + '" data-field="width" data-id="' + zone.id + '" class="zone-input mt-1 w-full bg-gray-800 rounded p-1 text-sm"></label>' +
                                                    '<label class="text-xs">Alto<input type="number" value="' + zone.height + '" data-field="height" data-id="' + zone.id + '" class="zone-input mt-1 w-full bg-gray-800 rounded p-1 text-sm"></label>' +
                                                    '</div>' +
                                                '</div>';
                                            }).join('');
                                        }

                                        function draw() {
                                            if (panel.classList.contains('hidden')) return;
                                            updateCanvasSize();
                                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                                            ctx.save();
                                            ctx.translate(state.panOffset.x, state.panOffset.y);
                                            ctx.scale(state.scale, state.scale);

                                            ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                                            ctx.lineWidth = 5 / state.scale;
                                            ctx.setLineDash([15 / state.scale, 15 / state.scale]);
                                            state.zones.forEach(function(z) { ctx.strokeRect(0, 0, z.width, z.height); });
                                            ctx.setLineDash([]);

                                            ctx.fillStyle = '#9ca3af';
                                            state.profiles.forEach(function(p) { ctx.fillRect(p.x, p.y, p.width, p.height); });

                                            state.panels.forEach(function(p) {
                                                ctx.fillStyle = 'rgba(30, 58, 138, 0.85)';
                                                ctx.fillRect(p.x, p.y, p.width, p.height);
                                                ctx.strokeStyle = '#3b82f6';
                                                ctx.lineWidth = 15 / state.scale;
                                                ctx.strokeRect(p.x, p.y, p.width, p.height);
                                            });

                                            state.clamps.forEach(function(c) {
                                                ctx.fillStyle = c.clampType === 'mid' ? 'rgba(234, 179, 8, 0.9)' : 'rgba(168, 85, 247, 0.9)';
                                                ctx.fillRect(c.x, c.y, c.width, c.height);
                                            });

                                            if (state.selectedObject) {
                                                ctx.strokeStyle = '#f59e0b';
                                                ctx.lineWidth = 20 / state.scale;
                                                const s = state.selectedObject;
                                                ctx.strokeRect(s.x, s.y, s.width, s.height);
                                            }
                                            ctx.restore();
                                            updateTotals();
                                        }

                                        function updateClamps() {
                                            state.clamps = [];
                                            state.profiles.forEach(function(p) {
                                                const panelsOnProfile = [];
                                                const isHorizProfile = p.width > p.height;
                                                state.panels.forEach(function(panelItem) {
                                                    const isVertPanel = panelItem.height > panelItem.width;
                                                    if (isHorizProfile && isVertPanel) {
                                                        const y_overlap = panelItem.y < p.y + p.height && panelItem.y + panelItem.height > p.y;
                                                        const x_midpoint_inside = (panelItem.x + panelItem.width / 2) > p.x && (panelItem.x + panelItem.width / 2) < p.x + p.width;
                                                        if (y_overlap && x_midpoint_inside) panelsOnProfile.push(panelItem);
                                                    } else if (!isHorizProfile && !isVertPanel) {
                                                        const x_overlap = panelItem.x < p.x + p.width && panelItem.x + panelItem.width > p.x;
                                                        const y_midpoint_inside = (panelItem.y + panelItem.height / 2) > p.y && (panelItem.y + panelItem.height / 2) < p.y + p.height;
                                                        if (x_overlap && y_midpoint_inside) panelsOnProfile.push(panelItem);
                                                    }
                                                });
                                                if (isHorizProfile) panelsOnProfile.sort(function(a, b) { return a.x - b.x; });
                                                else panelsOnProfile.sort(function(a, b) { return a.y - b.y; });
                                                if (panelsOnProfile.length > 0) {
                                                    const first = panelsOnProfile[0];
                                                    const last = panelsOnProfile[panelsOnProfile.length - 1];
                                                    if (isHorizProfile) {
                                                        state.clamps.push({ x: first.x - CLAMP_END_WIDTH, y: p.y, width: CLAMP_END_WIDTH, height: CLAMP_HEIGHT, clampType: 'end' });
                                                        state.clamps.push({ x: last.x + last.width, y: p.y, width: CLAMP_END_WIDTH, height: CLAMP_HEIGHT, clampType: 'end' });
                                                    } else {
                                                        state.clamps.push({ y: first.y - CLAMP_END_WIDTH, x: p.x, height: CLAMP_END_WIDTH, width: CLAMP_HEIGHT, clampType: 'end' });
                                                        state.clamps.push({ y: last.y + last.height, x: p.x, height: CLAMP_END_WIDTH, width: CLAMP_HEIGHT, clampType: 'end' });
                                                    }
                                                }
                                                for (let i = 0; i < panelsOnProfile.length - 1; i++) {
                                                    const p1 = panelsOnProfile[i];
                                                    const p2 = panelsOnProfile[i + 1];
                                                    if (isHorizProfile) {
                                                        const gap = p2.x - (p1.x + p1.width);
                                                        if (gap > 0 && gap < 100) {
                                                            state.clamps.push({ x: p1.x + p1.width + gap / 2 - CLAMP_MID_WIDTH / 2, y: p.y, width: CLAMP_MID_WIDTH, height: CLAMP_HEIGHT, clampType: 'mid' });
                                                        }
                                                    } else {
                                                        const gap = p2.y - (p1.y + p1.height);
                                                        if (gap > 0 && gap < 100) {
                                                            state.clamps.push({ y: p1.y + p1.height + gap / 2 - CLAMP_MID_WIDTH / 2, x: p.x, height: CLAMP_MID_WIDTH, width: CLAMP_HEIGHT, clampType: 'mid' });
                                                        }
                                                    }
                                                }
                                            });
                                            draw();
                                        }

                                        function getObjectAt(worldX, worldY) {
                                            for (let i = state.panels.length - 1; i >= 0; i--) {
                                                const pItem = state.panels[i];
                                                if (worldX > pItem.x && worldX < pItem.x + pItem.width && worldY > pItem.y && worldY < pItem.y + pItem.height) return pItem;
                                            }
                                            for (let i = state.profiles.length - 1; i >= 0; i--) {
                                                const pItem = state.profiles[i];
                                                if (worldX > pItem.x && worldX < pItem.x + pItem.width && worldY > pItem.y && worldY < pItem.y + pItem.height) return pItem;
                                            }
                                            return null;
                                        }

                                        function handleMouseDown(e) {
                                            if (e.button === 2) {
                                                state.isPanning = true;
                                                state.panStart = { x: e.clientX, y: e.clientY };
                                                return;
                                            }
                                            const worldPos = worldMousePos(e.clientX, e.clientY);
                                            const object = getObjectAt(worldPos.x, worldPos.y);
                                            state.selectedObject = object;
                                            if (state.mode === 'move' && object) {
                                                state.isDragging = true;
                                                state.dragOffset.x = worldPos.x - object.x;
                                                state.dragOffset.y = worldPos.y - object.y;
                                            } else if (state.mode === 'delete' && object) {
                                                if (object.type === 'panel') {
                                                    state.panels = state.panels.filter(function(p) { return p.id !== object.id; });
                                                }
                                                if (object.type === 'profile') {
                                                    state.profiles = state.profiles.filter(function(p) { return p.id !== object.id; });
                                                }
                                                state.selectedObject = null;
                                                updateClamps();
                                            }
                                            draw();
                                        }
                                        function handleMouseMove(e) {
                                            if (state.isPanning) {
                                                const dx = e.clientX - state.panStart.x;
                                                const dy = e.clientY - state.panStart.y;
                                                state.panOffset.x += dx;
                                                state.panOffset.y += dy;
                                                state.panStart = { x: e.clientX, y: e.clientY };
                                                draw();
                                                return;
                                            }
                                            if (state.isDragging && state.selectedObject) {
                                                const worldPos = worldMousePos(e.clientX, e.clientY);
                                                state.selectedObject.x = worldPos.x - state.dragOffset.x;
                                                state.selectedObject.y = worldPos.y - state.dragOffset.y;
                                                draw();
                                            }
                                        }
                                        function handleMouseUp() {
                                            if (state.isDragging) updateClamps();
                                            state.isDragging = false;
                                            state.isPanning = false;
                                        }
                                        function handleWheel(e) {
                                            e.preventDefault();
                                            const zoomIntensity = 0.1;
                                            const wheel = e.deltaY < 0 ? 1 : -1;
                                            const zoom = Math.exp(wheel * zoomIntensity);
                                            const mousePos = worldMousePos(e.clientX, e.clientY);
                                            state.panOffset.x -= mousePos.x * (zoom - 1);
                                            state.panOffset.y -= mousePos.y * (zoom - 1);
                                            state.scale *= zoom;
                                            draw();
                                        }

                                        function setupDragAndDrop() {
                                            assetPanel.addEventListener('dragstart', function(e) { e.dataTransfer.setData('text/plain', 'panel'); });
                                            assetProfile.addEventListener('dragstart', function(e) { e.dataTransfer.setData('text/plain', 'profileH'); });
                                            canvas.addEventListener('dragover', function(e) { e.preventDefault(); });
                                            canvas.addEventListener('drop', function(e) {
                                                e.preventDefault();
                                                const type = e.dataTransfer.getData('text/plain');
                                                const worldPos = worldMousePos(e.clientX, e.clientY);
                                                elementCounter++;
                                                const id = 'el-' + elementCounter;
                                                const panelW = parseInt(panelWidthInput.value);
                                                const panelH = parseInt(panelHeightInput.value);
                                                const profileL = parseInt(profileLengthInput.value);
                                                if (type === 'panel') {
                                                    state.panels.push({ id: id, type: 'panel', x: worldPos.x - panelW / 2, y: worldPos.y - panelH / 2, width: panelW, height: panelH });
                                                } else if (type === 'profileH') {
                                                    state.profiles.push({ id: id, type: 'profile', x: worldPos.x - profileL / 2, y: worldPos.y - PROFILE_VISUAL_WIDTH / 2, width: profileL, height: PROFILE_VISUAL_WIDTH });
                                                }
                                                updateClamps();
                                            });
                                        }

                                        function updateTotals() {
                                            totalPanelsEl.textContent = state.panels.length;
                                            totalClampsEl.textContent = state.clamps.length;
                                        }
                                        function worldMousePos(screenX, screenY) {
                                            const rect = canvas.getBoundingClientRect();
                                            const x = (screenX - rect.left - state.panOffset.x) / state.scale;
                                            const y = (screenY - rect.top - state.panOffset.y) / state.scale;
                                            return { x: x, y: y };
                                        }

                                        function switchMode(mode) {
                                            state.mode = mode;
                                            toolbar.querySelectorAll('.tool-btn').forEach(function(btn) {
                                                btn.classList.toggle('active', btn.dataset.mode === mode);
                                            });
                                        }

                                        toolbar.addEventListener('click', function(e) {
                                            const btn = e.target.closest('.tool-btn');
                                            if (!btn) return;
                                            switchMode(btn.dataset.mode);
                                        });

                                        zonesContainer.addEventListener('input', function(e) {
                                            if (!e.target.classList.contains('zone-input')) return;
                                            updateZone(e.target.dataset.id, e.target.dataset.field, e.target.value);
                                        });

                                        zonesContainer.addEventListener('click', function(e) {
                                            if (!e.target.classList.contains('remove-zone-btn')) return;
                                            removeZone(e.target.dataset.id);
                                        });

                                        textureSelector.addEventListener('click', function(e) {
                                            const target = e.target.closest('[data-texture]');
                                            if (!target) return;
                                            textureSelector.querySelectorAll('.texture-thumb').forEach(function(el) { el.classList.remove('active'); });
                                            target.classList.add('active');
                                            canvas.style.backgroundImage = "url('" + target.dataset.texture + "')";
                                        });

                                        canvas.addEventListener('mousedown', handleMouseDown);
                                        canvas.addEventListener('mousemove', handleMouseMove);
                                        window.addEventListener('mouseup', handleMouseUp);
                                        canvas.addEventListener('contextmenu', function(e) { e.preventDefault(); });
                                        canvas.addEventListener('wheel', handleWheel, { passive: false });

                                        setupDragAndDrop();
                                        addZoneBtn.addEventListener('click', function() { addZone(); });
                                        addZone();

                                        panel.addEventListener('app:activated', function() {
                                            requestAnimationFrame(function() {
                                                draw();
                                            });
                                        });
                                        panel.addEventListener('app:deactivated', function() {
                                            state.isDragging = false;
                                            state.isPanning = false;
                                        });
                                        window.addEventListener('resize', function() {
                                            if (!panel.classList.contains('hidden')) {
                                                draw();
                                            }
                                        });
                                    })();
                                </script>
                            </div>
                            <div class="app-panel hidden text-left text-white" data-app-panel="menu-planner">
                                <div class="grid gap-6 md:grid-cols-[2fr,1fr] md:items-center">
                                    <div class="space-y-3">
                                        <h4 class="text-xl font-bold">Planificador semanal de menús</h4>
                                        <p class="text-sm text-slate-200">Organiza tus comidas arrastrando y soltando platos, genera automáticamente la lista de la compra y guarda tus menús en el navegador.</p>
                                        <ul class="list-disc list-inside space-y-1 text-sm text-slate-300">
                                            <li>Catálogo editable de primeros y segundos platos con iconos.</li>
                                            <li>Calendario semanal que puedes duplicar, limpiar o guardar.</li>
                                            <li>Lista de la compra con extras y recordatorios.</li>
                                        </ul>
                                        <div class="flex flex-wrap gap-2 pt-2">
                                            <span class="keyword-badge">hogar</span>
                                            <span class="keyword-badge">organización</span>
                                            <span class="keyword-badge">meal planning</span>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <a href="Pruebas/Index_1.html" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-full bg-blue-500 px-5 py-3 font-semibold text-white shadow-lg transition hover:bg-blue-600">
                                            <i class="fa-solid fa-arrow-up-right-from-square"></i>
                                            Abrir en nueva pestaña
                                        </a>
                                        <p class="mt-3 text-xs text-slate-300">Se abrirá en una pestaña nueva para mantener esta vista.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
<!-- Sección 3: Enlaces Web -->
            <section id="enlaces-content" class="content-section content-hidden">
                <div class="pt-8 space-y-8">
                    <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                        <div>
                            <h3 class="text-2xl font-bold border-b-2 pb-2 border-gray-400">Enlaces de Interés</h3>
                            <p class="text-sm text-gray-600">Agrupados por temática para localizar recursos rápidamente.</p>
                        </div>
                        <p class="text-xs text-gray-500">Gestiona el listado desde <code class="bg-gray-100 px-1 py-0.5 rounded">js/site-data.js</code>.</p>
                    </div>
                    <div id="link-groups" class="space-y-6"></div>
                </div>
            </section>
        </main>

    </div>

    <script src="js/site-data.js"></script>
    <script src="js/home-sections.js"></script>
</body>
</html>
